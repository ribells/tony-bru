<!doctype html>
<html lang="en">
    <script src="https://kit.fontawesome.com/b551a8a195.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/style_sheet.css">
    <link rel="stylesheet" href="css/style_sheet_countries.css">
    <head>
        <title>Bombing Views 1944</title>

        <div class="title_section">
        <h1 class="title_text">
            Bombing Location in July 1944
        </h1>
        
        <button id = "1" class="btn"> <i class="fa-solid fa-play"></i> Play</button> 
        <button id = "2" class="btn"> <i class="fa-solid fa-pause"></i> Pause</button>
        <button id = "3" class="btn"> <i class="fa-solid fa-arrows-rotate"></i> Reset Time</button>
        <button id = "4" class="btn"> <i class="fa-solid fa-arrows-rotate"></i> Reset All</button>
        <p class="span_text"> Current Date:<span id="bombing_date" class = "span_text">7/1/1944</span> </p>
        </div>
        <style>
        .btn {
          background-color: Grey;
          border: none;
          color: white;
          padding: 10px 12px;
          font-size: 12px;
          cursor: pointer;
        }

        /* Darker background on mouse-over */
        .btn:hover {
          background-color: darkslategrey;
        }
        </style>

        <ul class="menu_ul">
        <li class="dropdown">
            <a href="index.html" class="main_btn"> <i class="fas fa-home"></i> Home</a>
        </li>
        <li class="dropdown">
            <a href="javascript:void(0)" class="dropbtn"> <i class="fas fa-microscope"></i> Explore</a>
            <div class="dropdown-content">
                <a href="theory_flight.html">Theory of Flight</a>
                <a href="types_plane.html">Types of Plane</a>
                <a href="battlefields.html">Air Battlefields</a>
            </li>
            <li class="dropdown">
                <a href="javascript:void(0)" class="dropbtn"> <i class="fas fa-globe-americas"></i> Countries Involved</a>
                <div class="dropdown-content">
                    <a href="germany.html">German Third Reich</a>
                    <a href="britain.html">United Kindom</a>
                    <a href="soviet-union.html">Soviet Union</a>
                    <a href="japan.html">Japanese Empire</a>
                    <a href="usa.html">United States</a>
                </div>
            </li>
        </ul>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/qgis2web.css"><link rel="stylesheet" href="css/fontawesome-all.min.css">
        <style>
        #map {
            width: 1617px;
            height: 895px;
            z-index: 9;
        }
        </style>
    </head>
    
    <body>

        <div class="main_check">
        <div id="hud" style="position:absolute; top:50px; left:50px; font-size:56px; z-index:10; color:white">
            
        </div>
        <input type="checkbox" id="check1" onclick="Ger_only()">
        <label>Germany:</label> <br>

        <input type="checkbox" id="check2" onclick="UK_only()"> 
        <label>UK:</label> <br>

        <input type="checkbox" id="check3" onclick="USA_only()">
        <label>USA:</label> <br>
         
        <input type="checkbox" id="check4" onclick="Other_only()">
        <label>Others:</label> <br>
        </div>

        


    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
    google.charts.load("current", {packages:['corechart']});
    google.charts.setOnLoadCallback(drawBarChart1);
    function drawBarChart1() {
        if (!timeline_mode){
      var data = google.visualization.arrayToDataTable([
        ["Country", "Daily_Tons", { role: "style" } ],
        ["UK", 0, "#e36041"],
        ["USA", 0, "#e1ad33"],
        ["Others", 0, "#40aa48"]
        ]);
  } else{
    var data = google.visualization.arrayToDataTable([
        ["Country", "Daily_Tons", { role: "style" } ],
        ["UK", total_tons[0][current_day-1], "#e36041"],
        ["USA", total_tons[1][current_day-1], "#e1ad33"],
        ["Others", total_tons[2][current_day-1], "#40aa48"]
        ]);
  }
        

      var view = new google.visualization.DataView(data);
      view.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" },
                       2]);

      var options = {
        title: "Daily Bombing Tons Distribution(Tons) in: " + current_date,
        width: 600,
        height: 400,
        bar: {groupWidth: "95%"},
        legend: { position: "none" },
      };
      var chart = new google.visualization.ColumnChart(document.getElementById("barchart1"));
      chart.draw(view, options);
  }
  </script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
    google.charts.load("current", {packages:['corechart']});
    google.charts.setOnLoadCallback(drawBarChart2);
    function drawBarChart2() {
        if (!timeline_mode){
      var data = google.visualization.arrayToDataTable([
        ["Country", "Total_Tons", { role: "style" } ],
        ["UK", getsum(total_tons[0]), "#e36041"],
        ["USA", getsum(total_tons[1]), "#e1ad33"],
        ["Others", getsum(total_tons[2]), "#40aa48"]
        ]);
  } else{
    var data = google.visualization.arrayToDataTable([
        ["Country", "Total_Tons", { role: "style" } ],
        ["UK", cumulative_tons[0], "#e36041"],
        ["USA", cumulative_tons[1], "#e1ad33"],
        ["Others", cumulative_tons[2], "#40aa48"]
        ]);
  }
        

      var view = new google.visualization.DataView(data);
      view.setColumns([0, 1,
                       { calc: "stringify",
                         sourceColumn: 1,
                         type: "string",
                         role: "annotation" },
                       2]);

      var options = {
        title: "Cumulative Bombing Tons Distribution(Tons) until: " + current_date,
        width: 600,
        height: 400,
        bar: {groupWidth: "95%"},
        legend: { position: "none" },
      };
      var chart = new google.visualization.ColumnChart(document.getElementById("barchart2"));
      chart.draw(view, options);
  }
  </script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawPieChart);

      function drawPieChart() {

        var data = google.visualization.arrayToDataTable([
          ['Country', 'Number of Missions'],
          ['Germany',bombing_counts[0]],
          ['UK',bombing_counts[1]],
          ['USA',bombing_counts[2]],
          ['OTHERS',bombing_counts[3]],
        ]);

        var sum = bombing_counts[0] + bombing_counts[1] + bombing_counts[2] + bombing_counts[3]
        var options = {
          title: 'Number of Total Missions: '+ sum
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

        chart.draw(data, options);
      }
      
    </script>

        <div id="map"></div>

        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/multi-style-layer.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="data/June_30_1944_0.js"></script>
        <script src="data/Axis_GermanyBombing_1944_1.js"></script>
        <script src="data/Allied_Bombing_JulySheet2_2.js"></script>
        <script src="data/Allied_Bombing_JulySheet2_3.js"></script>
        <script>
        var highlightLayer;
        var current_date = "7/1/1944";
        var intl_date = "01/07/1944";
        var current_day = 1;
        var animation_status = false;
        var timeline_mode = false;
        var stats_done = false;
        var dis_Ger = true;
        var dis_UK = true;
        var dis_USA = true;
        var dis_OTHER = true;
        var bombing_counts = [0, 0, 0, 0]; //Germany, UK, USA, Others
        var cumulative_tons = [0, 0, 0]; // UK, USA, Others
        var total_tons = [[1369.8, 3137.5, 12, 5251, 2792.5, 2553, 5399, 207.75, 1018, 1569.5, 133, 2618.45, 184.25, 992.25, 2115, 1580, 86, 3610, 620.5, 5280, 160.6, 152, 4204.75, 3032.5, 3535, 866.25, 265, 4046, 654, 149.5, 2044], 
                          [355, 786, 2245, 1579, 4256.7, 33, 986.14, 1287, 741.96, 474, 5292, 6473, 4220, 6574, 8754, 356, 891, 1460, 872, 794.56, 674, 5789, 3005.8, 768, 609, 879, 4589.32, 3709, 87, 906, 1259], 
                          [1763, 890.9, 654.7, 899, 1133, 562.72, 877, 92, 4361, 932, 711.73, 822.8, 2279.6, 1468, 2477, 2742, 556.9, 1782, 620.7, 77, 281.1, 3562, 300.9, 920, 788, 2689, 863, 356, 772.6, 4667.9, 1145.14]] 
                          //UK
                          //USA
                          //Others

        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:true, maxZoom:28, minZoom:1
        }).fitBounds([[36.196117087150604,-14.689586188133337],[57.687022848866626,24.176945508587128]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }

        function pop_June_30_1944_0(feature, layer) {

            layer.on({

                mouseout: function(e) {

                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                    
                },
                mouseover: highlightFeature,

            });

            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Name:</th>\
                        <td>' + (feature.properties['Name'] !== null ? autolinker.link(feature.properties['Name'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Position:</th>\
                        <td colspan="2">' + (feature.properties['Foreign_Po'] !== null ? autolinker.link(feature.properties['Foreign_Po'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Leader:</th>\
                        <td colspan="2">' + (feature.properties['Head_of_St'] !== null ? autolinker.link(feature.properties['Head_of_St'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});

        }

        function style_June_30_1944_0_0() {
            return {
                pane: 'pane_June_30_1944_0',
                opacity: 1,
                color: 'rgba(247,247,247,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(150,150,150,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_June_30_1944_0');
        map.getPane('pane_June_30_1944_0').style.zIndex = 400;
        map.getPane('pane_June_30_1944_0').style['mix-blend-mode'] = 'normal';
        var layer_June_30_1944_0 = new L.geoJson(json_June_30_1944_0, {
            attribution: '',
            interactive: true,
            dataVar: 'json_June_30_1944_0',
            layerName: 'layer_June_30_1944_0',
            pane: 'pane_June_30_1944_0',
            onEachFeature: pop_June_30_1944_0,
            style: style_June_30_1944_0_0,
        });
        bounds_group.addLayer(layer_June_30_1944_0);
        map.addLayer(layer_June_30_1944_0);

        function pop_Axis_GermanyBombing_1944_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td>' + (feature.properties['Volume Reference'] !== null ? autolinker.link(feature.properties['Volume Reference'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Start Date: </td>\
                        <td colspan="2">' + (feature.properties['Start Date'] !== null ? autolinker.link(feature.properties['Start Date'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>End Date: </td>\
                        <td colspan="2">' + (feature.properties['End Date'] !== null ? autolinker.link(feature.properties['End Date'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Time: </td>\
                        <td colspan="2">' + (feature.properties['Time'] !== null ? autolinker.link(feature.properties['Time'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Region: </td>\
                        <td colspan="2">' + (feature.properties['Civil Defence Region'] !== null ? autolinker.link(feature.properties['Civil Defence Region'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Location: </td>\
                        <td colspan="2">' + (feature.properties['Location'] !== null ? autolinker.link(feature.properties['Location'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Country: </td>\
                        <td colspan="2">' + (feature.properties['Country'] !== null ? autolinker.link(feature.properties['Country'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Address: </td>\
                        <td colspan="2">' + (feature.properties['Full Address'] !== null ? autolinker.link(feature.properties['Full Address'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Killed: </td>\
                        <td colspan="2">' + (feature.properties['Killed'] !== null ? autolinker.link(feature.properties['Killed'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Injured: </td>\
                        <td colspan="2">' + (feature.properties['Injured'] !== null ? autolinker.link(feature.properties['Injured'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td>Total: </td>\
                        <td colspan="2">' + (feature.properties['Total Casualties'] !== null ? autolinker.link(feature.properties['Total Casualties'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">Additional Notes: </td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Additional Notes'] !== null ? autolinker.link(feature.properties['Additional Notes'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_Axis_GermanyBombing_Normal() {
            if(!stats_done) {
                bombing_counts[0]++;
            }
            if (dis_Ger){
            return {
                pane: 'pane_Axis_GermanyBombing_1944_1',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(92,133,213,1.0)',
                interactive: true,
            }
        } else {
            return{
            pane: 'pane_Axis_GermanyBombing_1944_1',
                radius: 4.0,
                opacity: 0,
                color: 'rgba(128,17,25,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0,
                fill: true,
                fillOpacity: 0,
                fillColor: 'rgba(219,30,42,1.0)',
                interactive: true,
            }
        }

        }

        function style_Axis_GermanyBombing_Timeline(feature) {
            switch(String(feature.properties['Start Date'])) {
                case intl_date:
                if(!stats_done) {
                bombing_counts[0]++;
            }
                    return {
                        pane: 'pane_Axis_GermanyBombing_1944_1',
                        radius: 4.0,
                        opacity: 1,
                        color: 'rgba(35,35,35,1.0)',
                        dashArray: '',
                        lineCap: 'butt',
                        lineJoin: 'miter',
                        weight: 1,
                        fill: true,
                        fillOpacity: 1,
                        fillColor: 'rgba(92,133,213,1.0)',
                        interactive: true
                    }
                    break;
                default:
                    return {
                        pane: 'pane_Axis_GermanyBombing_1944_1',
                        radius: 4.0,
                        opacity: .1,
                        color: 'rgba(35,35,35,0.1)',
                        dashArray: '',
                        lineCap: 'butt',
                        lineJoin: 'miter',
                        weight: 1,
                        fill: true,
                        fillOpacity: 0.1,
                        fillColor: 'rgba(0,0,0,0.01)',
                        interactive: true
                    }
                    break;
            }
        }


 
        map.createPane('pane_Axis_GermanyBombing_1944_1');
        map.getPane('pane_Axis_GermanyBombing_1944_1').style.zIndex = 401;
        map.getPane('pane_Axis_GermanyBombing_1944_1').style['mix-blend-mode'] = 'normal';
        var layer_Axis_GermanyBombing_1944_1 = new L.geoJson(json_Axis_GermanyBombing_1944_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Axis_GermanyBombing_1944_1',
            layerName: 'layer_Axis_GermanyBombing_1944_1',
            pane: 'pane_Axis_GermanyBombing_1944_1',
            onEachFeature: pop_Axis_GermanyBombing_1944_1,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                if (timeline_mode == true){
                    return L.circleMarker(latlng, style_Axis_GermanyBombing_Timeline(feature));
                } else{
                    return L.circleMarker(latlng, style_Axis_GermanyBombing_Normal(feature));
                }
            },
        });
        bounds_group.addLayer(layer_Axis_GermanyBombing_1944_1);
        map.addLayer(layer_Axis_GermanyBombing_1944_1);





        function pop_Allied_Bombing_JulySheet2_3(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Mission ID:</th>\
                        <td colspan="2">' + (feature.properties['WWII_ID'] !== null ? autolinker.link(feature.properties['WWII_ID'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Mission Date:</th>\
                        <td colspan="2">' + (feature.properties['MSNDATE'] !== null ? autolinker.link(feature.properties['MSNDATE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Theater:</th>\
                        <td colspan="2">' + (feature.properties['THEATER'] !== null ? autolinker.link(feature.properties['THEATER'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Airforce ID:</th>\
                        <td colspan="2">' + (feature.properties['NAF'] !== null ? autolinker.link(feature.properties['NAF'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Executing Country:</th>\
                        <td colspan="2">' + (feature.properties['COUNTRY_FLYING_MISSION'] !== null ? autolinker.link(feature.properties['COUNTRY_FLYING_MISSION'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Target Country:</th>\
                        <td colspan="2">' + (feature.properties['TGT_COUNTRY'] !== null ? autolinker.link(feature.properties['TGT_COUNTRY'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Target Location:</th>\
                        <td colspan="2">' + (feature.properties['TGT_LOCATION'] !== null ? autolinker.link(feature.properties['TGT_LOCATION'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Target Type:</th>\
                        <td colspan="2">' + (feature.properties['TGT_TYPE'] !== null ? autolinker.link(feature.properties['TGT_TYPE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Latitude:</th>\
                        <td colspan="2">' + (feature.properties['LATITUDE'] !== null ? autolinker.link(feature.properties['LATITUDE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Longtitude:</th>\
                        <td colspan="2">' + (feature.properties['LONGITUDE'] !== null ? autolinker.link(feature.properties['LONGITUDE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Aircraft Type:</th>\
                        <td colspan="2">' + (feature.properties['AIRCRAFT_NAME'] !== null ? autolinker.link(feature.properties['AIRCRAFT_NAME'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Mission Type:</th>\
                        <td colspan="2">' + (feature.properties['MSN_TYPE'] !== null ? autolinker.link(feature.properties['MSN_TYPE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Altitude:</th>\
                        <td colspan="2">' + (feature.properties['ALTITUDE'] !== null ? autolinker.link(feature.properties['ALTITUDE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Total Tons:</th>\
                        <td colspan="2">' + (feature.properties['TOTAL_TONS'] !== null ? autolinker.link(feature.properties['TOTAL_TONS'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Takeoff Country:</th>\
                        <td colspan="2">' + (feature.properties['TAKEOFF_COUNTRY'] !== null ? autolinker.link(feature.properties['TAKEOFF_COUNTRY'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Takeoff Latitude:</th>\
                        <td colspan="2">' + (feature.properties['TAKEOFF_LATITUDE'] !== null ? autolinker.link(feature.properties['TAKEOFF_LATITUDE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Takeoff Longtitude:</th>\
                        <td colspan="2">' + (feature.properties['TAKEOFF_LONGITUDE'] !== null ? autolinker.link(feature.properties['TAKEOFF_LONGITUDE'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Aircraft Lost:</th>\
                        <td colspan="2">' + (feature.properties['AC_LOST'] !== null ? autolinker.link(feature.properties['AC_LOST'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Aircraft Damaged:</th>\
                        <td colspan="2">' + (feature.properties['AC_DAMAGED'] !== null ? autolinker.link(feature.properties['AC_DAMAGED'].toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_Allied_Bombing_July_Normal(feature) {
            switch(String(feature.properties['COUNTRY_FLYING_MISSION'])) {
                case 'GREAT BRITAIN':
                    if(!stats_done) {
                        bombing_counts[1]++;
                    }
                    if (dis_UK) {
						return {
								pane: 'pane_Allied_Bombing_JulySheet2_3',
								radius: 4.0,
								opacity: 1,
								color: 'rgba(35,35,35,1.0)',
								dashArray: '',
								lineCap: 'butt',
								lineJoin: 'miter',
								weight: 1,
								fill: true,
								fillOpacity: 1,
								fillColor: 'rgba(227,96,65,1.0)',
								interactive: true,
						}
					} else {
						return {
							pane: 'pane_Allied_Bombing_JulySheet2_3',
							radius: 4.0,
							opacity: .1,
							color: 'rgba(35,35,35,0.1)',
							dashArray: '',
							lineCap: 'butt',
							lineJoin: 'miter',
							weight: 1,
							fill: true,
							fillOpacity: 0,
							fillColor: 'rgba(200,200,200,0.1)',
							interactive: true,
						}
					}
                    break;
                case 'USA':
                    if(!stats_done) {
                        bombing_counts[2]++;
                    }
                    if (dis_USA){
						return {
							pane: 'pane_Allied_Bombing_JulySheet2_3',
							radius: 4.0,
							opacity: 1,
							color: 'rgba(35,35,35,1.0)',
							dashArray: '',
							lineCap: 'butt',
							lineJoin: 'miter',
							weight: 1,
							fill: true,
							fillOpacity: 1,
							fillColor: 'rgba(255,173,51,1.0)',
							interactive: true,
						}
					} else {
						return {
							pane: 'pane_Allied_Bombing_JulySheet2_3',
							radius: 4.0,
							opacity: .1,
							color: 'rgba(35,35,35,0.1)',
							dashArray: '',
							lineCap: 'butt',
							lineJoin: 'miter',
							weight: 1,
							fill: true,
							fillOpacity: 0,
							fillColor: 'rgba(200,200,200,0.1)',
							interactive: true,
						}
					}
                    break;
                default:
                    if(!stats_done) {
                        bombing_counts[3]++;
                    }
                    if (dis_OTHER){
						return {
							pane: 'pane_Allied_Bombing_JulySheet2_3',
							radius: 4.0,
							opacity: 1,
							color: 'rgba(35,35,35,1.0)',
							dashArray: '',
							lineCap: 'butt',
							lineJoin: 'miter',
							weight: 1,
							fill: true,
							fillOpacity: 1,
							fillColor: 'rgba(64,170,72,1.0)',
							interactive: true,
						}
					} else{
						return {
							pane: 'pane_Allied_Bombing_JulySheet2_3',
							radius: 4.0,
							opacity: .1,
							color: 'rgba(35,35,35,0.1)',
							dashArray: '',
							lineCap: 'butt',
							lineJoin: 'miter',
							weight: 1,
							fill: true,
							fillOpacity: 0,
							fillColor: 'rgba(200,200,200,0.1)',
							interactive: true,
						}
					}
                    break;
            }
        }

        function style_Allied_Bombing_July_Timeline(feature) {
            switch(String(feature.properties['MSNDATE'])) {
                case current_date:
                    switch(String(feature.properties['COUNTRY_FLYING_MISSION'])) {
                case 'GREAT BRITAIN':
                    if(!stats_done) {
                        bombing_counts[1]++;
                    }
                    
                    return {
						pane: 'pane_Allied_Bombing_JulySheet2_3',
						radius: 4.0,
						opacity: 1,
						color: 'rgba(35,35,35,1.0)',
						dashArray: '',
						lineCap: 'butt',
						lineJoin: 'miter',
						weight: 1,
						fill: true,
						fillOpacity: 1,
						fillColor: 'rgba(227,96,65,1.0)',
						interactive: true,
					}
       
                    break;
                case 'USA':
					if(!stats_done) {
						bombing_counts[2]++;
					}
			   
					return {
					pane: 'pane_Allied_Bombing_JulySheet2_3',
					radius: 4.0,
					opacity: 1,
					color: 'rgba(35,35,35,1.0)',
					dashArray: '',
					lineCap: 'butt',
					lineJoin: 'miter',
					weight: 1,
					fill: true,
					fillOpacity: 1,
					fillColor: 'rgba(255,173,51,1.0)',
					interactive: true,
				}
         
                    break;
                default:
                    if(!stats_done) {
                        bombing_counts[3]++;
                    }
                    
                    return {
                pane: 'pane_Allied_Bombing_JulySheet2_3',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(64,170,72,1.0)',
                interactive: true,
            }
        }
                    break;
                default:
                    return {
                        pane: 'pane_Allied_Bombing_JulySheet2_3',
                        radius: 4.0,
                        opacity: .05,
                        color: 'rgba(35,35,35,0.05)',
                        dashArray: '',
                        lineCap: 'butt',
                        lineJoin: 'miter',
                        weight: 1,
                        fill: true,
                        fillOpacity: .05,
                        fillColor: 'rgba(0,0,0,0.05)',
                        interactive: true,
                    }
                    break;
            }
        }

        map.createPane('pane_Allied_Bombing_JulySheet2_3');
        map.getPane('pane_Allied_Bombing_JulySheet2_3').style.zIndex = 403;
        map.getPane('pane_Allied_Bombing_JulySheet2_3').style['mix-blend-mode'] = 'normal';
        var layer_Allied_Bombing_JulySheet2_3 = new L.geoJson(json_Allied_Bombing_JulySheet2_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Allied_Bombing_JulySheet2_3',
            layerName: 'layer_Allied_Bombing_JulySheet2_3',
            pane: 'pane_Allied_Bombing_JulySheet2_3',
            onEachFeature: pop_Allied_Bombing_JulySheet2_3,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                if (timeline_mode == true){
                    return L.circleMarker(latlng, style_Allied_Bombing_July_Timeline(feature));
                } else{
                    return L.circleMarker(latlng, style_Allied_Bombing_July_Normal(feature));
                }
            },
        });
    
        bounds_group.addLayer(layer_Allied_Bombing_JulySheet2_3);
        map.addLayer(layer_Allied_Bombing_JulySheet2_3);

        function getsum(input_array){
            var sum = 0;
            for (let i = 0; i < input_array.length; i++) {
                sum += input_array[i];
            }
            return sum;
        }
    
        function pause(){
            animation_status = !animation_status;
            if (animation_status == true){
                setTimeout(updateTime, 500);
            }
        }

        function reset(){
            animation_status = false;
            current_day = 0;
            current_date = "7/0/1944";
            intl_date = "00/07/1944";
            setTimeout(updateTime, 500);
        }

        function mode_switch() {
            cumulative_tons = [0,0,0];
            timeline_mode = false;
            map.removeLayer(layer_Axis_GermanyBombing_1944_1);
            map.removeLayer(layer_Allied_Bombing_JulySheet2_3);
            layer_Axis_GermanyBombing_1944_1 = new L.geoJson(json_Axis_GermanyBombing_1944_1, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Axis_GermanyBombing_1944_1',
                layerName: 'layer_Axis_GermanyBombing_1944_1',
                pane: 'pane_Axis_GermanyBombing_1944_1',
                onEachFeature: pop_Axis_GermanyBombing_1944_1,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_Axis_GermanyBombing_Normal(feature));
                },
            });
            bounds_group.addLayer(layer_Axis_GermanyBombing_1944_1);
            map.addLayer(layer_Axis_GermanyBombing_1944_1);

            layer_Allied_Bombing_JulySheet2_3 = new L.geoJson(json_Allied_Bombing_JulySheet2_3, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Allied_Bombing_JulySheet2_3',
                layerName: 'layer_Allied_Bombing_JulySheet2_3',
                pane: 'pane_Allied_Bombing_JulySheet2_3',
                onEachFeature: pop_Allied_Bombing_JulySheet2_3,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_Allied_Bombing_July_Normal(feature));
                },
            });
            bounds_group.addLayer(layer_Allied_Bombing_JulySheet2_3);
            map.addLayer(layer_Allied_Bombing_JulySheet2_3);

            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawPieChart);
            
            drawBarChart1();
            drawBarChart2();

		}
        
        function updateTime() {
            timeline_mode = true;

            //update the date
            if(current_day < 31) {
                current_day++;
                current_date = "7/" + current_day  + "/1944";
                if(current_day < 10) {
                    intl_date = "0" + current_day + "/07/1944";
                } else {
                    intl_date = "" + current_day + "/07/1944";
                }
                document.getElementById('bombing_date').innerHTML = current_date;
            }
            
            map.removeLayer(layer_Axis_GermanyBombing_1944_1);
            map.removeLayer(layer_Allied_Bombing_JulySheet2_3);
            document.getElementById('piechart').innerHTML = "";
            document.getElementById('barchart1').innerHTML = "";
            document.getElementById('barchart2').innerHTML = "";
            cumulative_tons[0] += total_tons[0][current_day-1];
            cumulative_tons[1] += total_tons[1][current_day-1];
            cumulative_tons[2] += total_tons[2][current_day-1];
            //alert(cumulative_tons);
            bombing_counts = [0, 0, 0, 0];
            stats_done = false;

            layer_Axis_GermanyBombing_1944_1 = new L.geoJson(json_Axis_GermanyBombing_1944_1, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Axis_GermanyBombing_1944_1',
                layerName: 'layer_Axis_GermanyBombing_1944_1',
                pane: 'pane_Axis_GermanyBombing_1944_1',
                onEachFeature: pop_Axis_GermanyBombing_1944_1,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_Axis_GermanyBombing_Timeline(feature));
                },
            });
            bounds_group.addLayer(layer_Axis_GermanyBombing_1944_1);
            map.addLayer(layer_Axis_GermanyBombing_1944_1);

            layer_Allied_Bombing_JulySheet2_3 = new L.geoJson(json_Allied_Bombing_JulySheet2_3, {
                attribution: '',
                interactive: true,
                dataVar: 'json_Allied_Bombing_JulySheet2_3',
                layerName: 'layer_Allied_Bombing_JulySheet2_3',
                pane: 'pane_Allied_Bombing_JulySheet2_3',
                onEachFeature: pop_Allied_Bombing_JulySheet2_3,
                pointToLayer: function (feature, latlng) {
                    var context = {
                        feature: feature,
                        variables: {}
                    };
                    return L.circleMarker(latlng, style_Allied_Bombing_July_Timeline(feature));
                },
            });
            bounds_group.addLayer(layer_Allied_Bombing_JulySheet2_3);
            map.addLayer(layer_Allied_Bombing_JulySheet2_3);
            if (current_day < 31){

            if (animation_status){
                setTimeout(updateTime, 500);
            }
        }
            
            drawPieChart();
            drawBarChart1();
            drawBarChart2();
        }
        
        document.getElementById("1").onclick = function(){pause()}
        document.getElementById("2").onclick = function(){pause()}
        document.getElementById("3").onclick = function(){reset()}
        document.getElementById("4").onclick = function(){mode_switch()}

        document.getElementById("check1").checked = true;
        document.getElementById("check2").checked = true;
        document.getElementById("check3").checked = true;
        document.getElementById("check4").checked = true;


        stats_done = true;
        
        //alert(bombing_counts);

        function Ger_only(){
            dis_Ger = !dis_Ger;
            mode_switch();
        }

        function UK_only(){
            dis_UK = !dis_UK;
            mode_switch();
        }

        function USA_only(){
            dis_USA = !dis_USA;
            mode_switch();
        }

        function Other_only(){
            dis_OTHER = !dis_OTHER;
            mode_switch();
        }
        </script>

        <div id="piechart" style="width: 375px; height: 250px; "></div>
        <div id="barchart1" style="width: 300px; height: 250px;"></div>
        <div id="barchart2" style="width: 300px; height: 250px;"></div>
        <style>
        	#piechart {
              position: absolute;
              top: 400px;
              left: -50px;
              width: 200px;
              opacity: 0.8;
              z-index: 10;
        	}

            #barchart1 {
              position: absolute;
              top: 600px;
              left: -50px;
              width: 100px;
              height: 200px;
              opacity: 0.8;
              z-index: 10;
            }

            #barchart2 {
              position: absolute;
              top: 950px;
              left: -50px;
              width: 100px;
              height: 200px;
              opacity: 0.8;
              z-index: 10;
            }

            .main_check {
              background-color:lightblue;
              width: 150px;
              height: 50px;
              border: 1px solid #c3c3c3;
              display: flex;
              flex-wrap: wrap;
              align-content: center;
              align-items: left;
			}
        </style>
    </body>
</html>